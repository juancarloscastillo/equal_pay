---
title: 'ISSP Chile 1999, 2009 & 2019 - Salary Gap & meritocracy'
author: "Julio César Iturra Sanhueza - jciturra@uc.cl"
output: rmdformats::html_clean  
---

```{r include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE,message = FALSE)
options(scipen=999)
rm(list=ls())
```


```{r }
{
  library(dplyr)
  library(here)
  library(sjlabelled)
  library(sjPlot)
  library(ggplot2)
  library(knitr)
  library(kableExtra)
  library(GPArotation)
  library(lavaan)
  library(Cairo);options(shiny.usecairo=TRUE) # Para la calidad de los plots
}
```

```{r data, include=FALSE,cache=FALSE}
# issp99<- read_stata(path = here("data","issp1999.dta"))
# issp09<- read_stata(path = here("data","issp2009.dta"))
# issp19<- read_stata(path = here("data","issp2019.dta"))
```

```{r seleccionar Chile}
# cl99 <- issp99 %>% filter(v3==30)
# cl09 <- issp09 %>% filter(V4==152)
# cl19 <- issp19
# names(cl99) <- toupper(names(cl99))
# save(cl99,file = here("data","issp1999CL.RData"))
# save(cl09,file = here("data","issp2009CL.RData"))
# save(cl19,file = here("data","issp2019CL.RData"))
# # Load data ***************************************************************
# load(file = here("data","issp1999CL.RData"))
# load(file = here("data","issp2009CL.RData"))
# load(file = here("data","issp2019CL.RData"))
```

```{r load data}
load(file = here("data","issp1999CL.RData"))
load(file = here("data","issp2009CL.RData"))
load(file = here("data","issp2019CL.RData"))
```

# Brechas salarios percibida y justa

```{r salario percibido y justo 1999}
salarios99 <- cl99 %>% select(V3,
                              V21,V16,    # Salario percibio obrero y gerente
                              V31,V26)# Salario justo    obrero y gerente
# M2_P2_PRESIDENTE cuanto gana GERENTE
# M2_P2_OBRERO cuanto gana OBRERO
# M2_P3_PRESIDENTE cuanto deberia ganar GERENTE
# M2_P3_OBRERO cuanto deberia ganar OBRERO
# table(salarios99$V21) #  99999999999
# table(salarios99$V16) #  99999999998 99999999999
# table(salarios99$V31) # 99999999998 99999999999 
# table(salarios99$V26) # 99999999998 99999999999 
salarios99$V21[salarios99$V21 %in% c(99999999998,99999999999)] <- NA
salarios99$V16[salarios99$V16 %in% c(99999999998,99999999999)] <- NA
salarios99$V31[salarios99$V31 %in% c(99999999998,99999999999)] <- NA
salarios99$V26[salarios99$V26 %in% c(99999999998,99999999999)] <- NA

salarios99$V3 <- as_character(salarios99$V3)

#--- Nombres sustantivos para analisis
salarios99 <- rename(salarios99,pais=V3,salperger=V16,salperobr=V21,saljusger=V26,saljusobr=V31)
```

```{r remover outliers 1999, include=FALSE}
table(salarios99$salperobr) # <22000000 120000000 
table(salarios99$saljusobr) # <30000000
table(salarios99$salperger)
table(salarios99$saljusger)
#Quitar outliers *************************
sal99 <- salarios99 %>% filter(salperobr<22000000 & saljusobr<30000000)
# Filtrato por outliers < a $22.000.000 en salario percibido obrero
# Filtrato por outliers < a $30.000.000 en salario justo obrero
sal99$gap_perc  <-  as.numeric(sal99$salperger/sal99$salperobr) # brecha total salario percibido 
sal99$gap_just  <-  as.numeric(sal99$saljusger/sal99$saljusobr) # brecha total salario justo
```

```{r gap salario 1999}
#---Brecha salarial percibida
salarios99$gap_perc   <-  as.numeric(salarios99$salperger/salarios99$salperobr) # diferencia total
salarios99$lngap_perc <-  as.numeric(log(salarios99$gap_perc))                 # diferencia log

#---Brecha salarial justa
salarios99$gap_just   <-  as.numeric(salarios99$saljusger/salarios99$saljusobr) # diferencia total
salarios99$lngap_just <-  as.numeric(log(salarios99$gap_just))                # diferencia log
```

```{r salario percibido y justo 2009}
salarios09 <- cl09 %>% select(V5,
                              V23,V25, # Salario percibio obrero y gerente
                              V28,V30) # Salario justo    obrero y gerente


# table(salarios09$V23) # cuanto gana GERENTE
# table(salarios09$V25) # cuanto gana OBRERO
# table(salarios09$V28) # cuando deberia ganar GERENTE
# table(salarios09$V30) # cuanto deberia ganar OBRERO
salarios09$V23[salarios09$V23 %in%c(-99,-98,-97,999999999996)] <- NA
salarios09$V25[salarios09$V25 %in%c(-99,-98,-97)]              <- NA
salarios09$V28[salarios09$V28 %in%c(-99,-98,-97)]              <- NA
salarios09$V30[salarios09$V30 %in%c(-99,-98,-97)]              <- NA



salarios09$V5 <- as_character(salarios09$V5)

#--- Nombres sustantivos para analisis
salarios09 <- rename(salarios09,pais=V5,salperger=V23,salperobr=V25,saljusger=V28,saljusobr=V30)
```

```{r remover outliers 2009, include=FALSE}
table(salarios09$salperobr) #   80     150     158     160     180     190     200     300
table(salarios09$saljusobr) #   190      230      250      300      350      500
table(salarios09$salperger) # 5000     10000     20000
table(salarios09$saljusger)
#Quitar outliers *************************
sal09 <- salarios09 %>% filter(salperobr>300 & saljusobr>500 & salperger >=100000 & saljusger >=100000)
# Filtrato por outliers < a $22.000.000 en salario percibido obrero
# Filtrato por outliers < a $30.000.000 en salario justo obrero
sal09$gap_perc  <-  as.numeric(sal09$salperger/sal09$salperobr) # brecha total salario percibido 
sal09$gap_just  <-  as.numeric(sal09$saljusger/sal09$saljusobr) # brecha total salario justo
```

```{r gap salario 2009}
#---Brecha salarial percibida
salarios09$gap_perc   <-  as.numeric(salarios09$salperger/salarios09$salperobr) # diferencia total
salarios09$lngap_perc <-  as.numeric(log(salarios09$gap_perc))                # diferencia log

#---Brecha salarial justa
salarios09$gap_just   <-  as.numeric(salarios09$saljusger/salarios09$saljusobr) # diferencia total
salarios09$lngap_just <-  as.numeric(log(salarios09$gap_just))                # diferencia log
```

```{r salario percibido y justo 2019}
salarios19 <- cl19 %>% select(M2_P2_PRESIDENTE,M2_P2_OBRERO,  # Salario percibio obrero y gerente
                              M2_P3_PRESIDENTE,M2_P3_OBRERO) # Salario justo    obrero y gerente

# table(salarios19$M2_P2_PRESIDENTE) # cuanto gana GERENTE
# table(salarios19$M2_P2_OBRERO)     # cuanto gana OBRERO
# table(salarios19$M2_P3_PRESIDENTE) # cuando deberia ganar GERENTE
# table(salarios19$M2_P3_OBRERO )    # cuanto deberia ganar OBRERO
# salarios09$V23[salarios09$V23 %in%c(-99,-98,-97,999999999996)] <- NA
# salarios09$V25[salarios09$V25 %in%c(-99,-98,-97)]              <- NA
# salarios09$V28[salarios09$V28 %in%c(-99,-98,-97)]              <- NA
# salarios09$V30[salarios09$V30 %in%c(-99,-98,-97)]              <- NA

#--- Nombres sustantivos para analisis
salarios19 <- rename(salarios19,salperger=M2_P2_PRESIDENTE,salperobr=M2_P2_OBRERO,
                     saljusger=M2_P3_PRESIDENTE,saljusobr=M2_P3_OBRERO)
```

```{r remover outliers 2019, include=FALSE}
table(salarios19$salperobr) # 500
table(salarios19$saljusobr) # 300     500     600     800
table(salarios19$salperger) # ok 
table(salarios19$saljusger) # ok
#Quitar outliers *************************
sal19 <- salarios19 %>% filter(salperobr>500 & saljusobr>800)
# Filtrato por outliers < a $22.000.000 en salario percibido obrero
# Filtrato por outliers < a $30.000.000 en salario justo obrero
sal19$gap_perc  <-  as.numeric(sal19$salperger/sal19$salperobr) # brecha total salario percibido 
sal19$gap_just  <-  as.numeric(sal19$saljusger/sal19$saljusobr) # brecha total salario justo
```

```{r gap salario 2019}
#---Brecha salarial percibida
salarios19$gap_perc   <-  as.numeric(salarios19$salperger/salarios19$salperobr) # diferencia total
salarios19$lngap_perc <-  as.numeric(log(salarios19$gap_perc))                  # diferencia log


#---Brecha salarial justa
salarios19$gap_just   <-  as.numeric(salarios19$saljusger/salarios19$saljusobr) # diferencia total
salarios19$lngap_just <-  as.numeric(log(salarios19$gap_just))                # diferencia log
```

## Brecha total 

```{r descriptivos brecha total 1999-2019}
# Tabla 1 ****************************************************************************************

table1<- rbind(psych::describe(salarios99$gap_perc),
               psych::describe(salarios09$gap_perc),
               psych::describe(salarios19$gap_perc))

rownames(table1) <- c("1999","2009","2019")
table1 <- table1 %>% select(n,mean,sd,median,trimmed,min,max)
        
kable(table1,row.names = TRUE, digits = 2,caption = "Brecha total de salario percibido por año") %>% kable_styling()

# Tabla 2 ****************************************************************************************

table2<- rbind(psych::describe(salarios99$gap_just),
               psych::describe(salarios09$gap_just),
               psych::describe(salarios19$gap_just))

rownames(table2) <- c("1999","2009","2019")
table2 <- table2 %>% select(n,mean,sd,median,trimmed,min,max)
        
kable(table2,row.names = TRUE, digits = 2,caption = "Tabla: Brecha total de salario justo por año") %>% kable_styling()


# Tabla 3 ****************************************************************************************

table3<- rbind(psych::describe(sal99$gap_just),
               psych::describe(sal09$gap_just),
               psych::describe(sal19$gap_just))

rownames(table3) <- c("1999","2009","2019")
table3 <- table3 %>% select(n,mean,sd,median,trimmed,min,max)
        
kable(table3,row.names = TRUE, digits = 2,caption = "Tabla: Brecha total de salario justo por año") %>% kable_styling() %>% 
footnote(general = "Calculo realizado sin casos extremos superiores e inferiores \n Media recortada sin el 5% de cada extremo")

# Tabla 4 ****************************************************************************************

table4<- rbind(psych::describe(sal99$gap_perc),
               psych::describe(sal09$gap_perc),
               psych::describe(sal19$gap_perc))

rownames(table4) <- c("1999","2009","2019")
table4 <- table4 %>% select(n,mean,sd,median,trimmed,min,max)
        
kable(table4,row.names = TRUE, digits = 2,caption = "Tabla: Brecha total de salario percibido por año") %>% kable_styling() %>% 
footnote(general = "Calculo realizado sin casos extremos superiores e inferiores \n Media recortada sin el 5% de cada extremo")
```

## Brecha estimada (log)

```{r Tablas descriptivos ln(gaps)}
# Tabla 1 ****************************************************************************************
table1b<- rbind(psych::describe(log(salarios99$gap_perc)),
               psych::describe(log(salarios09$gap_perc)),
               psych::describe(log(salarios19$gap_perc)))
rownames(table1b) <- c("1999","2009","2019")
table1b <- table1b %>% select(n,mean,sd,median,trimmed,min,max)
kable(table1b,row.names = TRUE, digits = 2,caption = "Brecha total de ln(salario percibido) por año") %>% kable_styling()

# Tabla 2 ****************************************************************************************
table2b<- rbind(psych::describe(log(salarios99$gap_just)),
               psych::describe(log(salarios09$gap_just)),
               psych::describe(log(salarios19$gap_just)))
rownames(table2b) <- c("1999","2009","2019")
table2b <- table2b %>% select(n,mean,sd,median,trimmed,min,max)
kable(table2b,row.names = TRUE, digits = 2,caption = "Tabla: Brecha total de ln(salario justo) por año") %>% kable_styling()


# Tabla 3 ****************************************************************************************

table3b<- rbind(psych::describe(log(sal99$gap_just)),
               psych::describe(log(sal09$gap_just)),
               psych::describe(log(sal19$gap_just)))

rownames(table3b) <- c("1999","2009","2019")
table3b <- table3b %>% select(n,mean,sd,median,trimmed,min,max)
        
kable(table3b,row.names = TRUE, digits = 2,caption = "Tabla: Brecha total de ln(salario justo) por año") %>% kable_styling() %>% 
footnote(general = "Calculo realizado sin casos extremos superiores e inferiores \n Media recortada sin el 5% de cada extremo")

# Tabla 4 ****************************************************************************************

table4b<- rbind(psych::describe(log(sal99$gap_perc)),
               psych::describe(log(sal09$gap_perc)),
               psych::describe(log(sal19$gap_perc)))

rownames(table4b) <- c("1999","2009","2019")
table4b <- table4b %>% select(n,mean,sd,median,trimmed,min,max)
        
kable(table4b,row.names = TRUE, digits = 2,caption = "Tabla: Brecha total de ln(salario percibido) por año") %>% kable_styling() %>% 
footnote(general = "Calculo realizado sin casos extremos superiores e inferiores \n Media recortada sin el 5% de cada extremo")

```


```{r, fig.align='center', fig.width=10}
ggplot() + 
  geom_density(data = sal99,aes(x = log(gap_just),fill="1999", alpha=0.9)) + 
  geom_density(data = sal09,aes(x = log(gap_just),fill="2009", alpha=0.5)) +
  geom_density(data = sal19,aes(x = log(gap_just),fill="2019", alpha=0.5)) +
  geom_vline(xintercept = median(log(sal99$gap_just),na.rm = TRUE), linetype="dashed",color = "black",    size=1.5)+
  geom_vline(xintercept = median(log(sal09$gap_just),na.rm = TRUE), linetype="dotted",color = "navyblue", size=1.5)+
  geom_vline(xintercept = median(log(sal19$gap_just),na.rm = TRUE), linetype="dotted",color = "darkgreen",size=1.5)+
  xlab(label = "Salario justo Ln(Gerente/Obrero)")+
  guides(fill = guide_legend("Año"), alpha=FALSE) +
  theme_classic()
```


# Meritocracia {.tabset}

## 1999 {.tabset}

### Percepción {.tabset}

**(1) Esencial - No tiene importancia (5)** (8 no sabe, 9 no responde)

- v4: Importancia para surgir: provenir familia rica  (wfami)   

- V5: Importancia para surgir: Conocer personas adecuadas (knope)


**(1) Muy de acuerdo - Muy en desacuerdo (5)** (8 no sabe, 9 no responde)

- v6: Recompensas: En Chile las personas son remuneradas por sus esfuerzos (refor)

- v7: Recompensas: En Chile las personas son remuneradas por su inteligencia y capacidades (rinte)

- v8: Hoy en día, para llegar hasta el nivel más alto en Chile, hay que ser corrupto. (corru)

```{r}
merit99 <- cl99 %>% select(V4:V8,V49:V55)

merit99$V4 <- car::recode(merit99$V4,"c(8,9)=NA",as.numeric = TRUE)
merit99$V5 <- car::recode(merit99$V5,"c(8,9)=NA",as.numeric = TRUE)
merit99$V6 <- car::recode(merit99$V6,"c(8,9)=NA",as.numeric = TRUE)
merit99$V7 <- car::recode(merit99$V7,"c(8,9)=NA",as.numeric = TRUE)
merit99$V8 <- car::recode(merit99$V8,"c(8,9)=NA",as.numeric = TRUE)

merit99$V4 <- sjmisc::rec(merit99$V4,rec="rev")
merit99$V5 <- sjmisc::rec(merit99$V5,rec="rev")
merit99$V6 <- sjmisc::rec(merit99$V6,rec="rev")
merit99$V7 <- sjmisc::rec(merit99$V7,rec="rev")
merit99$V8 <- sjmisc::rec(merit99$V8,rec="rev")


merit99 <- rename(merit99,
                  wfami = V4,
                  knope = V5,
                  refor = V6,
                  rinte = V7,
                  corru = V8)

poly99a <- psych::polychoric(select(merit99,c(wfami,knope,refor,rinte,corru)),na.rm = TRUE)
```

```{r out.width='75%', fig.align='center',fig.cap="**Correlación Policórica para Batería de _Percepción_ de Meritocracia para Chile ISSP 1999**"}
corrplot::corrplot.mixed(poly99a$rho,order = "AOE")
```

```{r analisis factorial 1999 percepcion}
library(GPArotation)
sjPlot::sjt.fa(select(merit99,c(wfami,knope,refor,rinte)),
               method = "wls",
               nmbr.fctr = 2, 
               title="Analisis Factorial 1999 Percepcion")
```

```{r analisis factorial confirmatorio 199}

m1per99 <- '
gah_nmerit=~wfami+knope+corru
recom=~refor+rinte
'
fit1 <- cfa(model = m1per99,data = merit99)


```

```{r plot CFA 1}
semPlot::semPaths(fit1, "std", 
                  edge.color = "black", 
                  style = "ram", 
                  exoVar = TRUE, 
                  intercepts = F,
                  thresholds = F,
                  fade =F)
```



### Preferencia

**(1) Esencial - No tiene importancia (5)** (8 no sabe, 9 no responde)
OO
- v49:Importancia para pagar: nivel de responsabilidadad asociado al trabajo (respo)

- v50:Importancia para pagar: numero de años dedicados a educación y capacitación (neduc)

- v51:Importancia para pagar: si el trabajo requiere que se supervise a otras personas (suprv)

- v52:Importancia para pagar: Lo que se necesita para mantener a una familia (mafam)

- v53:Importancia para pagar: Que una persona tenga hijos que mantener (hchil)

- v54:Importancia para pagar: Lo bien que él/ella realiza su trabajo (gdwrk)

- v55:Importancia para pagar: Cuánto se esfuerza él ella en realizar su trabajo (effor)

```{r}

merit99$V49 <- car::recode(merit99$V49,"c(8,9)=NA",as.numeric = TRUE)
merit99$V50 <- car::recode(merit99$V50,"c(8,9)=NA",as.numeric = TRUE)
merit99$V51 <- car::recode(merit99$V51,"c(8,9)=NA",as.numeric = TRUE)
merit99$V52 <- car::recode(merit99$V52,"c(8,9)=NA",as.numeric = TRUE)
merit99$V53 <- car::recode(merit99$V53,"c(8,9)=NA",as.numeric = TRUE)
merit99$V54 <- car::recode(merit99$V54,"c(8,9)=NA",as.numeric = TRUE)
merit99$V55 <- car::recode(merit99$V55,"c(8,9)=NA",as.numeric = TRUE)

merit99$V49 <-sjmisc::rec(merit99$V49,rec="rev")
merit99$V50 <-sjmisc::rec(merit99$V50,rec="rev")
merit99$V51 <-sjmisc::rec(merit99$V51,rec="rev")
merit99$V52 <-sjmisc::rec(merit99$V52,rec="rev")
merit99$V53 <-sjmisc::rec(merit99$V53,rec="rev")
merit99$V54 <-sjmisc::rec(merit99$V54,rec="rev")
merit99$V55 <-sjmisc::rec(merit99$V55,rec="rev")


merit99 <- rename(merit99,
                  respo=V49,
                  neduc=V50,
                  suprv=V51,
                  mafam=V52,
                  hchil=V53,
                  gdwrk=V54,
                  effor=V55)
   

poly99b<- psych::polychoric(select(merit99,c(respo,neduc,suprv,mafam,hchil,gdwrk,effor)),na.rm = TRUE)
```


```{r out.width='75%', fig.align='center',fig.cap="**Correlación Policórica para Batería de _Preferencias_ en Meritocracia para Chile ISSP 1999**"}
corrplot::corrplot.mixed(poly99b$rho,order = "AOE")
```

```{r analisis factorial 1999 preferencia}
library(GPArotation)
sjPlot::sjt.fa(select(merit99,c(respo,neduc,suprv,mafam,hchil,gdwrk,effor)),
               method = "wls",
               nmbr.fctr = 3,
               title="Analisis Factorial 1999 Preferencia")
```

```{r analisis factorial confirmatorio 1999 preferencia}

m1pref99 <- '
resp=~respo+neduc+suprv
fami=~mafam+hchil
merit=~gdwrk+effor
'
fit2 <- cfa(model = m1pref99,data = merit99, ordered = c("respo","neduc","suprv","mafam","hchil","gdwrk","effor"))
summary(fit2, fit.measures=TRUE, standardized=TRUE)
```



## 2009 {.tabset}

### Percepción 

**(1) Esencial - No tiene importancia (5)** (8 no sabe, 9 no responde)

- V6 : Importancia para surgir: provenir de familia rica (wfami)

- V7 : Importancia para surgir: tener padres con buen nivel de educación (edpar)

- V8 : Importancia para surgir: que UD tenga un buen nivel de educación (slfed)

- V9 : Importancia para surgir: Tener ambición (ambit)

- V10: Importancia para surgir: trabajo duro (hwork)

- V11: Importancia para surgir: conocer a las personas adecuadas (knope)

- V12: Importancia para surgir: tener contactos políticos (polco)

- V13: Importancia para surgir: pagar coimas (corru)

- V14: Importancia para surgir: la raza u origen étnico de las personas (etnic)

- V15: Importancia para surgir: la religión que tengan las personas (relig)

- V16: Importancia para surgir: el sexo de las personas, ser hombre o mujer (gendr)

```{r}
merit09 <- cl09 %>% select(V6:V16,V47:V52)

merit09$V6  <- car::recode(merit09$V6 ,"c(8,9)=NA",as.numeric = TRUE) # Recodificación missing
merit09$V7  <- car::recode(merit09$V7 ,"c(8,9)=NA",as.numeric = TRUE)
merit09$V8  <- car::recode(merit09$V8 ,"c(8,9)=NA",as.numeric = TRUE)
merit09$V9  <- car::recode(merit09$V9 ,"c(8,9)=NA",as.numeric = TRUE)
merit09$V10 <- car::recode(merit09$V10,"c(8,9)=NA",as.numeric = TRUE)
merit09$V11 <- car::recode(merit09$V11,"c(8,9)=NA",as.numeric = TRUE)
merit09$V12 <- car::recode(merit09$V12,"c(8,9)=NA",as.numeric = TRUE)
merit09$V13 <- car::recode(merit09$V13,"c(8,9)=NA",as.numeric = TRUE)
merit09$V14 <- car::recode(merit09$V14,"c(8,9)=NA",as.numeric = TRUE)
merit09$V15 <- car::recode(merit09$V15,"c(8,9)=NA",as.numeric = TRUE)
merit09$V16 <- car::recode(merit09$V16,"c(8,9)=NA",as.numeric = TRUE)

merit09$V6  <-sjmisc::rec(merit09$V6 ,rec="rev")# invertir sentido escala
merit09$V7  <-sjmisc::rec(merit09$V7 ,rec="rev")# invertir sentido escala
merit09$V8  <-sjmisc::rec(merit09$V8 ,rec="rev")# invertir sentido escala
merit09$V9  <-sjmisc::rec(merit09$V9 ,rec="rev")# invertir sentido escala
merit09$V10 <-sjmisc::rec(merit09$V10,rec="rev")# invertir sentido escala
merit09$V11 <-sjmisc::rec(merit09$V11,rec="rev")# invertir sentido escala
merit09$V12 <-sjmisc::rec(merit09$V12,rec="rev")# invertir sentido escala
merit09$V13 <-sjmisc::rec(merit09$V13,rec="rev")# invertir sentido escala
merit09$V14 <-sjmisc::rec(merit09$V14,rec="rev")# invertir sentido escala
merit09$V15 <-sjmisc::rec(merit09$V15,rec="rev")# invertir sentido escala
merit09$V16 <-sjmisc::rec(merit09$V16,rec="rev")# invertir sentido escala

merit09<- rename(merit09,
                 wfami=V6 ,
                 edpar=V7 ,
                 slfed=V8 ,
                 ambit=V9 ,
                 hwork=V10,
                 knope=V11,
                 polco=V12,
                 corru=V13,
                 etnic=V14,
                 relig=V15,
                 gendr=V16)


poly09a <- psych::polychoric(select(merit09,c(wfami,edpar,slfed,ambit,hwork,knope,polco,corru,etnic,relig,gendr)),na.rm = TRUE)
```

```{r out.width='75%', fig.align='center',fig.cap="**Correlación Policórica para Batería de _Percepción_ en Meritocracia para Chile ISSP 2009**"}
corrplot::corrplot.mixed(poly09a$rho,order = "AOE")
```


```{r analisis factorial 2009 percepcion}
library(GPArotation)
sjPlot::sjt.fa(select(merit09,c(wfami,edpar,slfed,ambit,hwork,polco,corru,etnic,relig,gendr)),
               method = "wls",
               nmbr.fctr = 4,
               title = "Analisis Factorial 2009 Percepcion")
```


### Preferencia

- V47:Importancia para pagar: el nivel de responsabilidad que tiene el trabajo (respo)

- V48:Importancia para pagar: el numero de años dedicados a la educación y capacitación (neduc)

- V49:Importancia para pagar: lo que se necesita para mantener una familia (mafam)

- V50:Importancia para pagar: El que la persona tenga hijos que mantener (hchil)

- V51:Importancia para pagar: lo bien que él o ella realiza su tabajo (gdwrk)

- V52:Importancia para pagar: Lo que él o ella se esfuerza al realizar su trabajo (effor)

```{r}

merit09$V47  <- car::recode(merit09$V47,"c(8,9)=NA",as.numeric = TRUE) # Recodificación missing
merit09$V48  <- car::recode(merit09$V48,"c(8,9)=NA",as.numeric = TRUE)
merit09$V49  <- car::recode(merit09$V49,"c(8,9)=NA",as.numeric = TRUE)
merit09$V50  <- car::recode(merit09$V50,"c(8,9)=NA",as.numeric = TRUE)
merit09$V51  <- car::recode(merit09$V51,"c(8,9)=NA",as.numeric = TRUE)
merit09$V52  <- car::recode(merit09$V52,"c(8,9)=NA",as.numeric = TRUE)


merit09$V47  <-sjmisc::rec(merit09$V47 ,rec="rev")# invertir sentido escala
merit09$V48  <-sjmisc::rec(merit09$V48 ,rec="rev")# invertir sentido escala
merit09$V49  <-sjmisc::rec(merit09$V49 ,rec="rev")# invertir sentido escala
merit09$V50  <-sjmisc::rec(merit09$V50 ,rec="rev")# invertir sentido escala
merit09$V51  <-sjmisc::rec(merit09$V51 ,rec="rev")# invertir sentido escala
merit09$V52  <-sjmisc::rec(merit09$V52 ,rec="rev")# invertir sentido escala

merit09<- rename(merit09,
                 respo=V47,
                 neduc=V48,
                 mafam=V49,
                 hchil=V50,
                 gdwrk=V51,
                 effor=V52)


poly09b <- psych::polychoric(select(merit09,c(respo,neduc,mafam,hchil,gdwrk,effor)),na.rm = TRUE)
```

```{r out.width='75%', fig.align='center',fig.cap="**Correlación Policórica para Batería de _Preferencias_ en Meritocracia para Chile ISSP 2009**"}
corrplot::corrplot.mixed(poly09b$rho,order = "AOE")
```

```{r analisis factorial 2009 preferencia}
library(GPArotation)
sjPlot::sjt.fa(select(merit09,c(respo,neduc,mafam,hchil,gdwrk,effor)),
               method = "wls",
               nmbr.fctr = 2,
               title = "Analisis Factorial 2009 Preferencia")
```

## 2019 {.tabset}

### Percepción

**(1) Esencial - No tiene importancia (5)** (8 no sabe, 9 no responde)

- M2_P1_1 : Para surgir en la vida:  Tener ambición   

- M2_P1_2 : Para surgir en la vida:  Provenir de una familia rica    

- M2_P1_3 : Para surgir en la vida:  Tener padres con buen nivel de educación    

- M2_P1_4 : Para surgir en la vida:  Que UD tenga un buen nivel de educación   

- M2_P1_5 : Para surgir en la vida:  El Trabajo Duro    

- M2_P1_6 : Para surgir en la vida:  Conocer a la personas adecuadas    

- M2_P1_7 : Para surgir en la vida:  Tener contactos políticos    

- M2_P1_8 : Para surgir en la vida:  Pagar coimas   

- M2_P1_9 : Para surgir en la vida:  La raza u origen étnico de la persona 

- M2_P1_10: Para surgir en la vida:  la religión de las personas   

- M2_P1_11: Para surgir en la vida:  el sexo de las personas    

```{r}
merit19 <- cl19 %>% select(M2_P1_1:M2_P1_11,M2_P14_1:M2_P14_4)

merit19$M2_P1_1  <- car::recode(merit19$M2_P1_1  ,"c(8,9)=NA",as.numeric = TRUE) # Recodificación missing
merit19$M2_P1_2  <- car::recode(merit19$M2_P1_2  ,"c(8,9)=NA",as.numeric = TRUE)
merit19$M2_P1_3  <- car::recode(merit19$M2_P1_3  ,"c(8,9)=NA",as.numeric = TRUE)
merit19$M2_P1_4  <- car::recode(merit19$M2_P1_4  ,"c(8,9)=NA",as.numeric = TRUE)
merit19$M2_P1_5  <- car::recode(merit19$M2_P1_5  ,"c(8,9)=NA",as.numeric = TRUE)
merit19$M2_P1_6  <- car::recode(merit19$M2_P1_6  ,"c(8,9)=NA",as.numeric = TRUE)
merit19$M2_P1_7  <- car::recode(merit19$M2_P1_7  ,"c(8,9)=NA",as.numeric = TRUE)
merit19$M2_P1_8  <- car::recode(merit19$M2_P1_8  ,"c(8,9)=NA",as.numeric = TRUE)
merit19$M2_P1_9  <- car::recode(merit19$M2_P1_9  ,"c(8,9)=NA",as.numeric = TRUE)
merit19$M2_P1_10 <- car::recode(merit19$M2_P1_10 ,"c(8,9)=NA",as.numeric = TRUE)
merit19$M2_P1_11 <- car::recode(merit19$M2_P1_11 ,"c(8,9)=NA",as.numeric = TRUE)

merit19$M2_P1_1  <-sjmisc::rec(merit19$M2_P1_1 ,rec="rev")# invertir sentido escala
merit19$M2_P1_2  <-sjmisc::rec(merit19$M2_P1_2 ,rec="rev")# invertir sentido escala
merit19$M2_P1_3  <-sjmisc::rec(merit19$M2_P1_3 ,rec="rev")# invertir sentido escala
merit19$M2_P1_4  <-sjmisc::rec(merit19$M2_P1_4 ,rec="rev")# invertir sentido escala
merit19$M2_P1_5  <-sjmisc::rec(merit19$M2_P1_5 ,rec="rev")# invertir sentido escala
merit19$M2_P1_6  <-sjmisc::rec(merit19$M2_P1_6 ,rec="rev")# invertir sentido escala
merit19$M2_P1_7  <-sjmisc::rec(merit19$M2_P1_7 ,rec="rev")# invertir sentido escala
merit19$M2_P1_8  <-sjmisc::rec(merit19$M2_P1_8 ,rec="rev")# invertir sentido escala
merit19$M2_P1_9  <-sjmisc::rec(merit19$M2_P1_9 ,rec="rev")# invertir sentido escala
merit19$M2_P1_10 <-sjmisc::rec(merit19$M2_P1_10,rec="rev")# invertir sentido escala
merit19$M2_P1_11 <-sjmisc::rec(merit19$M2_P1_11,rec="rev")# invertir sentido escala




merit19<- rename(merit19,
                 ambit=M2_P1_1 ,
                 wfami=M2_P1_2 ,
                 edpar=M2_P1_3 ,
                 slfed=M2_P1_4 ,
                 hwork=M2_P1_5 ,
                 knope=M2_P1_6 ,
                 polco=M2_P1_7 ,
                 corru=M2_P1_8 ,
                 etnic=M2_P1_9 ,
                 relig=M2_P1_10,
                 gendr=M2_P1_11 )


poly19a <- psych::polychoric(select(merit19,c(wfami,edpar,slfed,ambit,hwork,knope,polco,corru,etnic,relig,gendr)),na.rm = TRUE)
```

```{r out.width='75%', fig.align='center',fig.cap="**Correlación Policórica para Batería de _Percepción_ en Meritocracia para Chile ISSP 2019**"}
corrplot::corrplot.mixed(poly19a$rho,order = "AOE")
```

```{r analisis factorial 2019 percepcion}

sjPlot::sjt.fa(select(merit19,c(wfami,edpar,slfed,hwork,polco,corru,etnic,relig,gendr)),
               method = "wls",
               nmbr.fctr = 4,
               title = "Analisis Factorial 2019 Percepción")
```


### Preferencia

- M2_P14_1: Importancia para ganar:  El nivel de responsabilidad que tiene su trabajo

- M2_P14_2: Importancia para ganar:  El número de años dedicados a educación y capacitación

- M2_P14_3: Importancia para ganar:  El que la persona tenga hijos que mantener

- M2_P14_4: Importancia para ganar:  Lo bien que él o ella realiza su trabajo


```{r}
merit19$M2_P14_1  <- car::recode(merit19$M2_P14_1,"c(8,9)=NA",as.numeric = TRUE) # Recodificación missing
merit19$M2_P14_2  <- car::recode(merit19$M2_P14_2,"c(8,9)=NA",as.numeric = TRUE)
merit19$M2_P14_3  <- car::recode(merit19$M2_P14_3,"c(8,9)=NA",as.numeric = TRUE)
merit19$M2_P14_4  <- car::recode(merit19$M2_P14_4,"c(8,9)=NA",as.numeric = TRUE)



merit19$M2_P14_1  <-sjmisc::rec(merit19$M2_P14_1 ,rec="rev")# invertir sentido escala
merit19$M2_P14_2  <-sjmisc::rec(merit19$M2_P14_2 ,rec="rev")# invertir sentido escala
merit19$M2_P14_3  <-sjmisc::rec(merit19$M2_P14_3 ,rec="rev")# invertir sentido escala
merit19$M2_P14_4  <-sjmisc::rec(merit19$M2_P14_4 ,rec="rev")# invertir sentido escala

merit19<- rename(merit19,
                respo=M2_P14_1,
                neduc=M2_P14_2,
                hchil=M2_P14_3,
                gdwrk=M2_P14_4)


poly19b <- psych::polychoric(select(merit19,c(respo,neduc,hchil,gdwrk)),na.rm = TRUE)
```

```{r out.width='75%', fig.align='center',fig.cap="**Correlación Policórica para Batería de _Preferencias_ en Meritocracia para Chile ISSP 2019**"}
corrplot::corrplot.mixed(poly19b$rho,order = "AOE")
```

# Meritocracia y Brecha Salarial Justa


```{r render, eval=FALSE, include=FALSE}
rmarkdown::render(input = here("files","20190622_ISSP1999_2009_2019-Chilejuitsa.Rmd"))
```

